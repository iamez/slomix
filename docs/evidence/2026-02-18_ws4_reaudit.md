# Evidence: WS4-001 Security Re-Audit Snapshot
Date: 2026-02-12  
Workstream: WS4 (Security and Secrets Closure)  
Task: `WS4-001`  
Status: `done`

## Goal
Re-audit unresolved items from `docs/SECURITY_FIXES_2026-02-08.md` and publish current pass/fail state.

## Scope Rechecked
1. Hardcoded DB password remediation status.
2. Website XSS pending claim in `website/js/awards.js`.
3. Greatshot pending audit note from Feb 8 security doc.

## Findings Matrix
1. `P1 Hardcoded Database Password` -> `FAIL (still open)`
   - `python3 tools/secrets_manager.py audit` currently reports `72` occurrences (down from `77` before this pass).
   - Remaining matches are mostly docs/archives, plus active local config/scripts (`.env`, `config.json`, `bot/config.json`, `bot_config.json`, `dev_tools/*`, setup scripts).
2. `P2 XSS in awards onclick handlers` -> `PASS`
   - `website/js/awards.js` uses `escapeJsString(...)` in inline `onclick` payload:
     - `onclick="loadPlayerProfile('${escapeJsString(player.player)}')"`
3. `P3 Greatshot integration audit` -> `PARTIAL`
   - Reliability/enrichment work exists under WS6 (`crossref` type-safety and per-player enrichment tests), but full upstream feature-parity audit remains unproven.

## Hardening Applied In This Re-Audit Pass
Files:
1. `tests/conftest.py`
2. `.github/workflows/tests.yml`
3. `bot/dotenv-example`

Changes:
1. Replaced test fallback DB password with non-production default (`etlegacy_test_password`) in `tests/conftest.py`.
2. Updated CI workflow PostgreSQL test password values to `etlegacy_test_password`.
3. Replaced production password/token examples in `bot/dotenv-example` with placeholders.

## Validation
Commands:
```bash
python3 tools/secrets_manager.py audit
```
Result:
1. `72` remaining matches (after this pass).

```bash
pytest -q tests/unit/test_round_publisher_team_grouping.py tests/unit/test_round_publisher_map_scope.py tests/unit/test_timing_comparison_service_side_markers.py
```
Result:
1. `7 passed`

## Outcome
1. WS4-001 (re-audit snapshot) is complete and documented.
2. Secret-rotation closure remains open and is tracked under `WS4-002`.
