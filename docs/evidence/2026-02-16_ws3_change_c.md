# Evidence: WS3-003 Round Publisher Team Grouping
Date: 2026-02-12  
Workstream: WS3 (Team Display Improvements)  
Task: `WS3-003`  
Status: `in_progress`

## Goal
Group round publisher player output by side (Axis/Allies) with per-team ranking.

## Code Changes
File:
1. `bot/services/round_publisher_service.py`

What changed:
1. `publish_round_stats(...)` player rendering now groups by team section:
   - `âš”ï¸ Axis` (`team=1`)
   - `ğŸ›¡ï¸ Allies` (`team=2`)
   - `â“ Unknown Side` (fallback)
2. Ranking now resets per team section (team-local rank), while preserving existing detailed stat lines.
3. Team sections still chunk at embed-safe sizes and preserve map-summary/timing follow-up flow.

## Test Coverage
Files:
1. `tests/unit/test_round_publisher_team_grouping.py`
2. `tests/unit/test_round_publisher_map_scope.py`

Assertions:
1. Round embed contains separate Axis/Allies/Unknown fields.
2. Team-local rank ordering resets per section (`ğŸ¥‡` starts in each group).
3. Existing map-summary flow remains invoked.

Validation commands:
```bash
pytest -q tests/unit/test_round_publisher_team_grouping.py tests/unit/test_round_publisher_map_scope.py
```

```bash
pytest -q \
  tests/unit/test_round_publisher_team_grouping.py \
  tests/unit/test_round_publisher_map_scope.py \
  tests/unit/test_round_contract.py \
  tests/unit/test_stats_parser.py \
  tests/unit/test_gametime_synthetic_round.py \
  tests/unit/test_lua_round_teams_param_packing.py \
  tests/unit/test_timing_debug_service_session_join.py \
  tests/unit/test_lua_webhook_diagnostics.py \
  tests/unit/test_greatshot_crossref.py \
  tests/unit/test_greatshot_player_stats_enrichment.py \
  tests/unit/test_timing_comparison_service_side_markers.py
```

Results:
1. Focused round-publisher tests: `5 passed`
2. Combined regression batch: `44 passed`

## Remaining Gate
WS3 closeout remains blocked until WS1 live ingestion gate is passed.
