# Evidence: WS3-001 Timing Comparison Team Payload
Date: 2026-02-12  
Workstream: WS3 (Team Display Improvements)  
Task: `WS3-001`  
Status: `in_progress`

## Goal
Include per-player side/team data in timing-comparison payloads so downstream display can be team-aware.

## Code Changes
File:
1. `bot/services/timing_comparison_service.py`

What changed:
1. Added `_derive_player_side(axis_rows, allies_rows)` helper returning:
   - `team` canonical value (`1`, `2`, `0`)
   - `side_state` (`axis`, `allies`, `mixed`, `unknown`)
   - `side_marker` (`[AX]`, `[AL]`, `[MX]`, `[--]`)
2. Expanded stats-player aggregation query to compute team sample counts:
   - `axis_rows` from `team=1`
   - `allies_rows` from `team=2`
3. `_fetch_stats_file_data(...)` now emits `team`, `side_state`, `side_marker` for each player.

## Test Coverage
File:
1. `tests/unit/test_timing_comparison_service_side_markers.py`

Assertions:
1. Query includes `axis_rows` and `allies_rows` aggregates.
2. Payload includes canonical team + marker for axis/allies/mixed/unknown cases.

Validation command:
```bash
pytest -q tests/unit/test_timing_comparison_service_side_markers.py
```

Result:
1. `2 passed`

## Remaining Gate
WS3 closeout is blocked by WS1 live gate; this is implementation/test completion only.
