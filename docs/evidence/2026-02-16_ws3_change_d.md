# Evidence: WS3-004 Map Summary Side Markers
Date: 2026-02-12  
Workstream: WS3 (Team Display Improvements)  
Task: `WS3-004`  
Status: `in_progress`

## Goal
Add side markers to map-summary top performers, with explicit ambiguity handling.

## Code Changes
File:
1. `bot/services/round_publisher_service.py`

What changed:
1. Added `_derive_side_marker(axis_rows, allies_rows)` helper:
   - `[AXIS]` when only team 1 samples are present
   - `[ALLIES]` when only team 2 samples are present
   - `[MIXED]` when both team samples are present
   - `[UNK]` when team samples are missing
2. Updated map-summary top-performer SQL to aggregate team sample counts:
   - `SUM(CASE WHEN team = 1 THEN 1 ELSE 0 END) as axis_rows`
   - `SUM(CASE WHEN team = 2 THEN 1 ELSE 0 END) as allies_rows`
3. Prefixed top-performer lines with side marker.
4. Added `ðŸ§­ Side Markers` embed field with ambiguity note and count.

## Test Coverage
File:
1. `tests/unit/test_round_publisher_map_scope.py`

Added/updated assertions:
1. Query includes `axis_rows` and `allies_rows` aggregation.
2. Top-performer line renders `[AXIS]` marker in normal case.
3. Mixed-side player renders `[MIXED]`.
4. Side-marker note includes ambiguity count when mixed data exists.

Validation command:
```bash
pytest -q tests/unit/test_round_publisher_map_scope.py
```

Result:
1. `3 passed`

## Remaining Gate
Per tracker hard-gate, WS3 cannot be closed until WS1 live Lua-ingestion gate passes on fresh rounds.  
Implementation/test work is complete for this unit; runtime closeout remains pending.
