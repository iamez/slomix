# ET:Legacy Stats Website Configuration
# Copy this file to .env and fill in your values

# ===========================================
# DATABASE CONFIGURATION (Read-Only Access)
# ===========================================
DATABASE_TYPE=postgresql

# PostgreSQL Connection (use read-only user for security)
POSTGRES_HOST=localhost
POSTGRES_PORT=5432
POSTGRES_DATABASE=et_stats
POSTGRES_USER=website_readonly
POSTGRES_PASSWORD=your_secure_readonly_password

# Connection Pool Settings
POSTGRES_MIN_POOL=2
POSTGRES_MAX_POOL=10

# ===========================================
# WEB SERVER CONFIGURATION
# ===========================================
# Port for uvicorn (default: 7000 for local runbook)
WEBSITE_PORT=7000

# Host binding (0.0.0.0 for all interfaces, 127.0.0.1 for localhost only)
WEBSITE_HOST=0.0.0.0

# Enable auto-reload for development (disable in production)
WEBSITE_RELOAD=true

# ===========================================
# SESSION & SECURITY
# ===========================================
# CRITICAL: Change this to a secure random string in production!
# Generate with: python -c "import secrets; print(secrets.token_hex(32))"
SESSION_SECRET=change-this-to-a-secure-random-string-in-production

# ===========================================
# DISCORD OAUTH2 (Optional - for user authentication)
# ===========================================
# Get these from https://discord.com/developers/applications
DISCORD_CLIENT_ID=your_discord_app_client_id
DISCORD_CLIENT_SECRET=your_discord_app_client_secret
DISCORD_REDIRECT_URI=http://localhost:7000/auth/callback
# Comma-separated strict allowlist of callback URLs (include the redirect URI above)
DISCORD_REDIRECT_URI_ALLOWLIST=http://localhost:7000/auth/callback
# OAuth endpoint hardening
DISCORD_OAUTH_STATE_TTL_SECONDS=600
DISCORD_OAUTH_RATE_LIMIT_WINDOW_SECONDS=60
DISCORD_OAUTH_RATE_LIMIT_MAX_REQUESTS=40

# ===========================================
# CORS CONFIGURATION
# ===========================================
# Allowed origins for CORS (comma-separated)
# Example: http://localhost:3000,https://yourdomain.com
CORS_ORIGINS=http://localhost:7000,http://127.0.0.1:7000

# ===========================================
# AVAILABILITY API (Date-Based)
# ===========================================
# Session-ready threshold used by web metadata + get-ready sound trigger
AVAILABILITY_SESSION_READY_THRESHOLD=6

# Optional admin Discord IDs for admin-only UI controls (comma-separated)
WEBSITE_ADMIN_DISCORD_IDS=
# Optional promoter Discord IDs (comma-separated) for Promote action permissions.
PROMOTER_DISCORD_IDS=
# Promotion campaign behavior
AVAILABILITY_PROMOTION_TIMEZONE=Europe/Ljubljana
AVAILABILITY_PROMOTION_DRY_RUN_DEFAULT=false
AVAILABILITY_PROMOTION_GLOBAL_COOLDOWN=false
# Planning room: optional Discord private-thread auto-create on session creation.
# Keep disabled unless website runtime is allowed to call Discord API directly.
AVAILABILITY_PLANNING_DISCORD_CREATE_THREAD=false
AVAILABILITY_PLANNING_THREAD_PARENT_CHANNEL_ID=
# Optional dedicated bot token override for planning-thread creation.
# If empty and create-thread is enabled, DISCORD_BOT_TOKEN may be used as fallback.
AVAILABILITY_PLANNING_DISCORD_BOT_TOKEN=
# Minimum seconds between website link-token generations per user+channel
AVAILABILITY_LINK_TOKEN_MIN_INTERVAL_SECONDS=30
# Encryption key for Telegram/Signal handles (Fernet key, 44 chars base64)
# Generate with: python -c "from cryptography.fernet import Fernet; print(Fernet.generate_key().decode())"
CONTACT_DATA_ENCRYPTION_KEY=

# ===========================================
# PERFORMANCE / OBSERVABILITY
# ===========================================
# Use Redis in production; memory cache is single-process/dev only.
CACHE_BACKEND=redis
REDIS_URL=redis://localhost:6379/0
CACHE_DEFAULT_TTL_SECONDS=120
CACHE_LIVE_TTL_SECONDS=15
CACHE_LEADERBOARD_TTL_SECONDS=300
# Max JSON response size (bytes) eligible for HTTP cache storage.
CACHE_MAX_BODY_BYTES=2097152
# Comma-separated write-path prefixes that trigger full cache namespace invalidation.
CACHE_INVALIDATE_ON_WRITE_PREFIXES=/api/stats,/api/sessions,/api/proximity,/api/monitoring
RATE_LIMIT_ENABLED=true
RATE_LIMIT_WINDOW_SECONDS=60
RATE_LIMIT_REQUESTS_PER_WINDOW=180
RATE_LIMIT_HEAVY_REQUESTS_PER_WINDOW=45
RATE_LIMIT_CLEANUP_INTERVAL_SECONDS=60
RATE_LIMIT_MAX_TRACKED_KEYS=50000
PROMETHEUS_ENABLED=true
# Startup timeout (seconds) for non-critical Greatshot worker bootstrap.
GREATSHOT_STARTUP_TIMEOUT_SECONDS=20
# Disable Greatshot worker startup in constrained local/dev environments.
GREATSHOT_STARTUP_ENABLED=true

# ===========================================
# PATHS
# ===========================================
# Path to bot's database (if using SQLite fallback)
SQLITE_DB_PATH=bot/etlegacy_production.db

# Static files directory
STATIC_DIR=./

# ===========================================
# AVAILABILITY API (Date-Based)
# ===========================================
# Session-ready threshold used by web metadata + get-ready sound trigger
AVAILABILITY_SESSION_READY_THRESHOLD=6
# Optional admin Discord IDs for admin-only UI controls (comma-separated)
WEBSITE_ADMIN_DISCORD_IDS=
